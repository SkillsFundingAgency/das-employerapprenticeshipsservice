@using SFA.DAS.EAS.Domain.Models
@model SFA.DAS.EAS.Support.Web.Models.ChangeRoleViewModel;

@{
    var errorMessage = string.Empty;
}

@if (!ViewContext.ViewData.ModelState.IsValid)
{
    foreach (var error in ViewContext.ViewData.ModelState.Values.SelectMany(state => state.Errors))
    {
        errorMessage = error.ErrorMessage;
    }

    <div class="govuk-error-summary" data-module="govuk-error-summary">
        <div role="alert">
            <h2 class="govuk-error-summary__title">
                Errors to fix
            </h2>
            <div class="govuk-error-summary__body">
                <ul class="govuk-list govuk-error-summary__list">
                    <li>
                        <a href="#change-role-selection">@errorMessage</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <p class="govuk-body-l">Choose what you allow this team member to do.</p>

        <form method="POST" asp-route="@Url.Action("ChangeRole")" asp-route-Id="@Model.HashedAccountId" asp-route-UserRef="@Model.UserRef">
            <div class="govuk-form-group @(!ViewContext.ViewData.ModelState.IsValid ? "govuk-form-group--error" : "")">
                <fieldset class="govuk-fieldset">
                    <legend id="change-role-selection" class="govuk-fieldset__legend">
                        <span class="govuk-visually-hidden">Select a role</span>
                        @if (!string.IsNullOrWhiteSpace(errorMessage))
                        {
                            <span class="govuk-error-message">@errorMessage</span>
                        }
                    </legend>
                    <div class="govuk-radios" data-module="govuk-radios">
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="radio1" type="radio" name="Role" value="0" @(Model.Role == Role.None ? "checked" : "")/>
                            <label class="govuk-label govuk-radios__label" for="radio0">
                                @(RoleStrings.GetRoleDescription(Role.None))
                            </label>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="radio1" type="radio" name="Role" value="3" @(Model.Role == Role.Viewer ? "checked" : "")/>
                            <label class="govuk-label govuk-radios__label" for="radio1">
                                @(RoleStrings.GetRoleDescription(Role.Viewer))
                            </label>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="radio2" type="radio" name="Role" value="2" @(Model.Role == Role.Transactor ? "checked" : "")/>
                            <label class="govuk-label govuk-radios__label" for="radio2">
                                @(RoleStrings.GetRoleDescription(Role.Transactor))
                            </label>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="radio3" type="radio" name="Role" value="1" @(Model.Role == Role.Owner ? "checked" : "")/>
                            <label class="govuk-label govuk-radios__label" for="radio3">
                                @(RoleStrings.GetRoleDescription(Role.Owner))
                            </label>
                        </div>
                    </div>
                    <input type="hidden" value="@Model.UserRef"/>
                </fieldset>
            </div>
            <button type="submit" class="govuk-button" id="update">Update</button>
        </form>
    </div>
</div>