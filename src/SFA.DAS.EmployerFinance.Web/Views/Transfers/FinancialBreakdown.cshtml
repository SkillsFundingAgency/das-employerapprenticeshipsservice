@using System.Globalization
@model OrchestratorResponse<SFA.DAS.EmployerFinance.Web.ViewModels.Transfers.FinancialBreakdownViewModel>
@{
    ViewBag.PageID = "transfers-breakdown";
    ViewBag.Section = "finance";
    ViewBag.Title = "FinancialBreakdown";
    ViewBag.AnalyticsData.Vpv = $"/finance/transfers/breakdown";
    ViewBag.ZenDeskLabel = "eas-finance";
    var culture = new CultureInfo("en-GB");
}

<h1 class="heading-xlarge">View my transfer finances</h1>
<div class="grid-row">
    <div class="column-one-half">
        <h2 class="heading-medium">
            My transfer finances
        </h2>
        <p>This is a financial snapshot of what is available. </p>
        <details>
            <summary><span class="summary">Your transfer allowance for this financial year</span></summary>
            <div class="panel panel-border-narrow">
                <p>This is calculated every year on 6 April and shows in your account after 20 April.</p>
                <p>Transfer payments will leave your account before payments for your own apprenticeships.</p>
            </div>
        </details>
    </div>
</div>

<hr />

<h2 class="heading-medium">
    Transfer allowance for financial year @Model.Data.FinancialYearString
</h2>
<div class="grid-row">
    <div class="column-one-half">
        <table>
            <tr>
                <th scope="row">Your transfer allowance</th>
                <td class="numeric">@Model.Data.StartingTransferAllowance.ToString("C0", culture)</td>
            </tr>          
        </table>
        <details>
            <summary><span class="summary">How is my available transfer allowance calculated?</span></summary>
            <div class="panel panel-border-narrow">
                <p>Your total available transfer allowance takes into account any deductions made for in-house apprenticeships, if you have any.</p>
            </div>
        </details>
    </div>
    <div class="column-one-half">
        <div class="finance-data">
            <dl>
                <dt>Total available transfer allowance for @Model.Data.FinancialYearString</dt>
                <dd>@Model.Data.TotalAvailableTransferAllowance.ToString("C0", culture)</dd>
            </dl>
        </div>
    </div>
</div>

<hr />

<h2 class="heading-medium">
    Committed funds for financial year @Model.Data.FinancialYearString
</h2>

<div class="grid-row">
    <div class="column-one-half">
        <table>
            <tr>
                <th scope="row">Approved applications: accepted by applicant</th>
                <td class="numeric">@Model.Data.AcceptedPledgeApplications.ToString("C0", culture)</td>
            </tr>
            <tr>
                <th scope="row">Approved applications: awaiting acceptance by applicant</th>
                <td class="numeric">@Model.Data.ApprovedPledgeApplications.ToString("C0", culture)</td>
            </tr>
            <tr>
                <th scope="row">Transfer connections</th>
                <td class="numeric">@Model.Data.TransferConnections.ToString("C0", culture)</td>
            </tr>
            <tr>
                <th scope="row">Total estimated spend</th>
                <td class="numeric"><strong>@Model.Data.TotalEstimatedSpend.ToString("C0", culture)</strong></td>
            </tr>
        </table>
        <details>
            <summary><span class="summary">How are my committed funds calculated?</span></summary>
            <div class="panel panel-border-narrow">
                <p>Your committed funds are calculated by subtracting your <strong>total estimated spend</strong> from your <strong>@Model.Data.TotalAvailableTransferAllowance.ToString("C0", culture) total available transfer allowance</strong>.</p>
            </div>
        </details>
    </div>
    <div class="column-one-half">
        <div class="finance-data finance-data--highlight">
            <dl>
                <dt>Estimated remaining allowance for @Model.Data.FinancialYearString</dt>
                <dd>@Model.Data.EstimatedRemainingAllowance.ToString("C0", culture)</dd>
            </dl>
        </div>
    </div>
</div>

<hr />

<h2 class="heading-medium">
    Available pledge funds for financial year @Model.Data.FinancialYearString
</h2>
<div class="grid-row">
    <div class="column-one-half">
        <table>
            <tr>
                <th scope="row">You have pledged</th>
                <td class="numeric">@Model.Data.AmountPledged.ToString("C0", culture)</td>
            </tr>
            <tr>
                <th scope="row">Approved applications: accepted by applicant</th>
                <td class="numeric">@Model.Data.AcceptedPledgeApplications.ToString("C0", culture)</td>
            </tr>
            <tr>
                <th scope="row">Approved applications: awaiting acceptance by applicant</th>
                <td class="numeric">@Model.Data.ApprovedPledgeApplications.ToString("C0", culture)</td>
            </tr>

        </table>
        <details>
            <summary><span class="summary">How are my available pledge funds calculated?</span></summary>
            <div class="panel panel-border-narrow">
                <p>Your available pledge funds is calculated by subtracting your <strong>approved applications (accepted by applicant and awaiting acceptance by applicant)</strong> from the amount <strong>you have pledged</strong>.</p>
            </div>
        </details>
    </div>
    <div class="column-one-half">
        <div class="finance-data">
            <dl>
                <dt>Available pledge funds for @Model.Data.FinancialYearString</dt>
                <dd>@Model.Data.AvailablePledgedFunds.ToString("C0", culture)</dd>
            </dl>
        </div>
    </div>
</div>

<hr />

<h2 class="heading-medium">
    Pledged funds for financial year @Model.Data.FinancialYearString
</h2>

<div class="grid-row">
    <div class="column-one-half">
        <table>
            <tr>
                <th scope="row">You have pledged</th>
                <td class="numeric">@Model.Data.AmountPledged.ToString("C0", culture)</td>
            </tr>
            <tr>
                <th scope="row">Transfer connections</th>
                <td class="numeric">@Model.Data.TransferConnections.ToString("C0", culture)</td>
            </tr>
            <tr>
                <th scope="row">Total pledged and transfer connections</th>
                <td class="numeric"><strong>@Model.Data.TotalPledgedAndTransferConnections.ToString("C0", culture)</strong></td>
            </tr>
        </table>
        <details>
            <summary><span class="summary">How are my pledged funds calculated?</span></summary>
            <div class="panel panel-border-narrow">
                <p>The amount you can pledge for financial year @Model.Data.FinancialYearString is calculated by subtracting your <strong>total pledged and transfer connections</strong> from your <strong>@Model.Data.TotalAvailableTransferAllowance.ToString("C0", culture) total available transfer allowance</strong>.</p>
            </div>
        </details>
    </div>
    <div class="column-one-half">
        <div class="finance-data finance-data--highlight">
            <dl>
                <dt>How much more you can pledge for @Model.Data.FinancialYearString</dt>
                <dd>@Model.Data.TotalAvailablePledgedFunds.ToString("C0", culture)</dd>
            </dl>
        </div>
    </div>
</div>

<hr />

<div class="grid-row">
    <div class="column-two-thirds">
        <h2 class="heading-medium">
            Your transfer connections in future financial years
        </h2>
        <p>These finances show approved application for your pledge and for transfers where you have connected directly with an employer.</p>
        <p>This uses an estimated total cost of training, based on the funding band maxiumum for this apprenticeship.</p>
        <p>The yearly estimate costs are based on the planned start date of training and the 20% completion payment. It uses the financial year starting April. </p>
        <p>This estimate is based on the information provided in the transfer funding application. As details such as start and end dates, final agreed costs, and breaks in learning may change, it can only be used as a a guide.</p>

        <div class="grid-row">
            <div class="column-one-third">
                <div class="finance-data finance-data--future">
                    <dl>
                        <dt>Estimated committed spend 2021/22</dt>
                        <dd>£200,000</dd>
                    </dl>
                </div>
            </div>
            <div class="column-one-third">
                <div class="finance-data finance-data--future">
                    <dl>
                        <dt>Estimated committed spend 2022/23</dt>
                        <dd>£200,000</dd>
                    </dl>
                </div>
            </div>
            <div class="column-one-third">
                <div class="finance-data finance-data--future">
                    <dl>
                        <dt>Estimated committed spend 2023/24</dt>
                        <dd>£200,000</dd>
                    </dl>
                </div>
            </div>
        </div>


    </div>
</div>

<hr />

<div class="grid-row">
    <div class="column-two-thirds">
        <h2 class="heading-medium">
            Download transfers finance data
        </h2>
        <p>Below are two downloadable csv files that will provide you with a detailed breakdown of your transfer finances.</p>

        <div class="notice finance-notice">
            <i class="icon icon-important">
                <span class="visually-hidden">Warning</span>
            </i>
            <strong class="bold-small">
                Your projections was last updated on 14 November 2021
            </strong>
        </div>

        <p><a href="#">Download year-to-date finance data - excel</a></p>
        <p>This shows actual learner level spend based on transactions reported by training providers via ILRs.</p>

        <p><a href="#">Download forecasted finance data - excel</a></p>
        <p>
            This shows learner level forecasted financial data. This is based on the information provided within approved pledge
            applications and confirmed transfers. This is a forecast and subject to change as details such as start and end dates,
            final agreed costs and breaks in learning may change.
        </p>

    </div>
</div>

@section breadcrumb {
    <div class="breadcrumbs">
        <ol role="navigation">
            <li><a href="@Url.EmployerAccountsAction("teams")">Home</a></li>
            <li><a href="@Url.EmployerFinanceAction("finance")">Finance</a></li>
            <li><a href="@Url.EmployerAccountsAction("transfers")">Transfers</a></li>
            <li>Financial breakdown</li>
        </ol>
    </div>
}
